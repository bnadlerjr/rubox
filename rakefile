require 'rake'
require 'rake/testtask'
require 'rake/rdoctask'
require 'rake/gempackagetask'
require 'lib/rubox'

TITLE = 'Rubox'
MAIN_RDOC = 'README.rdoc'

TEST_FILES       = FileList['test/**/test_*.rb']
EXTRA_RDOC_FILES = ['README.rdoc', 'HISTORY.txt']

Rake::TestTask.new do |t|
  t.test_files = TEST_FILES
end

Rake::RDocTask.new do |t|
  t.main = MAIN_RDOC
  t.rdoc_dir = 'doc'
  t.rdoc_files.include(EXTRA_RDOC_FILES, 'lib/**/*.rb')
  t.options << '-q'
  t.title = TITLE
end

# Enable rcov if it's installed
begin
  require 'rcov/rcovtask'
  
  Rcov::RcovTask.new do |t|
    t.test_files = TEST_FILES
    t.output_dir = 'doc/coverage'
    t.rcov_opts << '-x /Library/Ruby/Gems/1.8/gems'
  end
rescue LoadError
  puts 'RCov not installed. RCov related tasks are not available.'
end

task :default => ['test']

spec = Gem::Specification.new do |spec|
  spec.author                = 'Bob Nadler, Jr.'
  spec.description           = 'A client library for the Box.net REST API.'
  spec.email                 = 'thethirdswitch [at] gmail'
  spec.extra_rdoc_files      = EXTRA_RDOC_FILES
  spec.files                 = `git ls-files`.split("\n") - ['.gitignore']
  spec.has_rdoc              = true
  spec.homepage              = 'http://bobnadler.com/rubox'
  spec.name                  = 'rubox'
  spec.required_ruby_version = '>=1.8.7'
  spec.test_files            = TEST_FILES
  spec.version               = Rubox::VERSION

  spec.summary = <<-SUMMARY
Provides a client interface to the Box.net API. It relies on the REST version 
of the API, version 1.0. For a listing of available API calls see the 
documentation for the Box.net API which can be found at
http://developers.box.net/ApiOverview.
SUMMARY

  spec.rdoc_options << '--title' << TITLE <<
                       '--main' << MAIN_RDOC

  spec.add_dependency('xml-simple', '>=1.0.12')
  spec.add_development_dependency('mocha', '>=0.9.8')
end

Rake::GemPackageTask.new(spec) do |pkg|
  pkg.need_zip = true
  pkg.need_tar = true
end
